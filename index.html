<!-- build time:Sun Nov 08 2020 00:20:50 GMT+0800 (China Standard Time) --><!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="hisen,hisenyuan"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="Java R &amp; D"><meta property="og:type" content="website"><meta property="og:title" content="HiSEN"><meta property="og:url" content="http://hisen.me/index.html"><meta property="og:site_name" content="HiSEN"><meta property="og:description" content="Java R &amp; D"><meta property="og:locale" content="zh-Hans"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="HiSEN"><meta name="twitter:description" content="Java R &amp; D"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"undefined",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:"",labels:""}}</script><link rel="canonical" href="http://hisen.me/"><title>HiSEN - Java R & D | hisen,hisenyuan</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?67bcfe73b301307394c3443503d43472";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">HiSEN</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Personal Technology Blog</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-booklist"><a href="/booklist" rel="section"><i class="menu-item-icon fa fa-fw fa-list-ol"></i><br>书单</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20201107-Shell-batch-decompression-and-rename/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20201107-Shell-batch-decompression-and-rename/" itemprop="url">Shell 批量解压文件并重命名 - 解决文件名冲突</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-07T22:36:56+08:00">2020-11-07 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span> </a></span></span><span id="/20201107-Shell-batch-decompression-and-rename/" class="leancloud_visitors" data-flag-title="Shell 批量解压文件并重命名 - 解决文件名冲突"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h1><p>由于某种原因，需要手工处理错误日志提取某些信息。<br>下载下来的日志文件是压缩包</p><h2 id="1-1-文件信息"><a href="#1-1-文件信息" class="headerlink" title="1.1 文件信息"></a>1.1 文件信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">system_error.log.2020-11-01.20201105200433.zip</span><br><span class="line">system_error.log.2020-11-01.20201105195953.zip</span><br><span class="line">system_error.log.2020-11-01.20201105200830.zip</span><br><span class="line">...省略</span><br></pre></td></tr></table></figure><h2 id="1-2-压缩包信息"><a href="#1-2-压缩包信息" class="headerlink" title="1.2 压缩包信息"></a>1.2 压缩包信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ unzip -v system_error.log.2020-11-01.20201105200830.zip</span><br><span class="line">Archive:  system_error.log.2020-11-01.20201105200830.zip</span><br><span class="line"> Length   Method    Size  Cmpr    Date    Time   CRC-32   Name</span><br><span class="line">--------  ------  ------- ---- ---------- ----- --------  ----</span><br><span class="line"> 4495560  Defl:N    78526  98% 11-01-2020 23:43 504551c6  system_error.log.2020-11-01</span><br><span class="line">--------          -------  ---                            -------</span><br><span class="line"> 4495560            78526  98%                            1 file</span><br></pre></td></tr></table></figure><p>压缩包文件名不一样，但是压缩包中的文件有一样的名字。<br>例如：system_error.log.2020-11-01</p><p>尝试使用如下方式，提示有重复，需要挨个选择如何处理，极度不便。<br>于是想使用 shell 来解决（ 之前没写过 shell ）</p><h2 id="1-2-尝试过程"><a href="#1-2-尝试过程" class="headerlink" title="1.2 尝试过程"></a>1.2 尝试过程</h2><div class="post-button text-center"><a class="btn" href="/20201107-Shell-batch-decompression-and-rename/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20201030-understanding-computer-storage-unit/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20201030-understanding-computer-storage-unit/" itemprop="url">计算机存储单位 - 以及常识</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-30T19:02:56+08:00">2020-10-30 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span> </a></span></span><span id="/20201030-understanding-computer-storage-unit/" class="leancloud_visitors" data-flag-title="计算机存储单位 - 以及常识"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="一、常见单位"><a href="#一、常见单位" class="headerlink" title="一、常见单位"></a>一、常见单位</h1><table><thead><tr><th>单位</th><th>英文全称</th><th>中文全称</th><th>转换</th></tr></thead><tbody><tr><td>b</td><td>bit</td><td>位</td><td>-</td></tr><tr><td>B</td><td>Byte</td><td>字节</td><td>1B=8b</td></tr><tr><td>KB</td><td>Kilo Byte</td><td>千字节</td><td>1KB=1024B</td></tr><tr><td>MB</td><td>Mega Byte</td><td>兆字节</td><td>1MB=1024KB</td></tr><tr><td>GB</td><td>Giga Byte</td><td>千兆</td><td>1GB=1024MB</td></tr><tr><td>TB</td><td>Trillion Byte</td><td>万亿字节</td><td>1TB=1024GB</td></tr><tr><td>PB</td><td>Peta Byte</td><td>千万亿字节</td><td>1PB=1024TB</td></tr><tr><td>EB</td><td>Exa Byte</td><td>百亿亿字节</td><td>1EB=1024PB</td></tr><tr><td>ZB</td><td>Zetta Byte</td><td>十万亿亿字节</td><td>1ZB=1024EB</td></tr><tr><td>YB</td><td>Yotta Byte</td><td>一亿亿亿字节</td><td>1YB=1024ZB</td></tr><tr><td>BB</td><td>Bronto Byte</td><td>一千亿亿亿字节</td><td>1BB=1024YB</td></tr><tr><td>NB</td><td>Nona Byte</td><td></td><td>1NB=1024BB</td></tr><tr><td>DB</td><td>Dogga Byte</td><td></td><td>1DB=1024NB</td></tr><tr><td>CB</td><td>Corydon Byte</td><td></td><td>1CB=1024DB</td></tr></tbody></table><p>进制除了 Byte 与 bit 之间是 8，其它的都是 1024，但是目前很多时候习惯用 1000，比如 1T ≈ 1000G;</p><h1 id="二、带宽-网速"><a href="#二、带宽-网速" class="headerlink" title="二、带宽/网速"></a>二、带宽/网速</h1><h2 id="2-1-带宽"><a href="#2-1-带宽" class="headerlink" title="2.1 带宽"></a>2.1 带宽</h2><p>运营商(ISP)带宽宣传常见的有：50M、100M、500M、1000M…<br>注意：这是传输速率，而不是下载速度。<br></p><div class="post-button text-center"><a class="btn" href="/20201030-understanding-computer-storage-unit/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20201026-Understanding-Linux-Load-Averages/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20201026-Understanding-Linux-Load-Averages/" itemprop="url">理解 Linux Load Averages</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-26T19:02:56+08:00">2020-10-26 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span> </a></span></span><span id="/20201026-Understanding-Linux-Load-Averages/" class="leancloud_visitors" data-flag-title="理解 Linux Load Averages"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="零、背景"><a href="#零、背景" class="headerlink" title="零、背景"></a>零、背景</h1><p>最近做压力测试，不同的系统的机器监控数据差异明显<br>A 系统：CPU 高 load 低<br>B 系统：CPU 低 load 高</p><p>那么是什么导致 A B 系统出现这种情况？<br>CPU 高了系统肯定跑不动了，那么 load 多高代表系统跑不动呢？</p><h1 id="一、解释"><a href="#一、解释" class="headerlink" title="一、解释"></a>一、解释</h1><ol><li>A 系统的原因<br>CPU 很忙，没有等待其它资源，瓶颈在 CPU。</li><li>B 系统的原因<br>等待磁盘 I/O 完成的进程过多，导致进程队列长度过大，<br>但是 CPU 运行的进程却很少，这样就导致负载过大，但 CPU 使用率低，瓶颈不在 CPU，可能在 I/O。</li></ol><h1 id="二、load-averages-知识"><a href="#二、load-averages-知识" class="headerlink" title="二、load averages 知识"></a>二、load averages 知识</h1><ol><li>Linux 系统下代表的是 system load averages。</li><li><p>Linux load averages track not just runnable tasks, but also tasks in the uninterruptible sleep state.<br>Linux 平均负载不仅跟踪可运行的任务，还跟踪处于不可中断睡眠状态的任务。</p></li><li><p>On Linux, load averages are (or try to be) “system load averages”, for the system as a whole, measuring the number of threads that are working and waiting to work (CPU, disk, uninterruptible locks). Put differently, it measures the number of threads that aren’t completely idle. Advantage: includes demand for different resources.<br>在 Linux 上，负载平均值是(或试图是)“系统负载平均值” ，对于整个系统来说，测量正在工作和等待工作的线程数(CPU、磁盘、不可中断锁)。换句话说，它测量的是没有完全空闲的线程数量。优势: 包括对不同资源的需求。</p></li><li>In 1993, a Linux engineer found a nonintuitive case with load averages, and with a three-line patch changed them forever from “CPU load averages” to what one might call “system load averages.” His change included tasks in the uninterruptible state, so that load averages reflected demand for disk resources and not just CPUs.<br>1993年，一位 Linux 工程师发现了一个与平均负载不直观的案例，一个三行补丁永远地将它们从“ CPU 负载平均值”改变为人们可能称之为“系统负载平均值”他的更改包括处于不可中断状态的任务，因此平均负载反映了对磁盘资源的需求，而不仅仅是 cpu。</li></ol><h1 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h1><ol><li>linux load averages 数字大，代表系统压力大;<div class="post-button text-center"><a class="btn" href="/20201026-Understanding-Linux-Load-Averages/#more" rel="contents">阅读全文 &raquo;</a></div></li></ol></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20201019-java-hotspot-vm-cms-g1-setting-log/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20201019-java-hotspot-vm-cms-g1-setting-log/" itemprop="url">Java HotSpot 虚拟机 CMS、G1 参数设置记录</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-19T21:20:00+08:00">2020-10-19 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span> </a></span></span><span id="/20201019-java-hotspot-vm-cms-g1-setting-log/" class="leancloud_visitors" data-flag-title="Java HotSpot 虚拟机 CMS、G1 参数设置记录"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="零、背景说明"><a href="#零、背景说明" class="headerlink" title="零、背景说明"></a>零、背景说明</h1><p>目前测试机器为 4C8G<br>两台机器完全处理一样的工作<br>大部分时间对象朝生夕死，很少进入老年代<br>CMS 指定了新生代最大 1536M，略微有点浪费<br>于是设置 G1 自动调节各个区域大小能否有所改善<br>也因为最近看了两本 JVM 相关的书籍，拿着锤子锤两下看看</p><h1 id="一、G1-设置"><a href="#一、G1-设置" class="headerlink" title="一、G1 设置"></a>一、G1 设置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-Xms4096M</span><br><span class="line">-Xmx4096M</span><br><span class="line">-XX:+UseG1GC</span><br><span class="line">-XX:+UnlockDiagnosticVMOptions</span><br><span class="line">-XX:SurvivorRatio=8</span><br><span class="line">-XX:+ParallelRefProcEnabled</span><br><span class="line">-XX:MaxTenuringThreshold=6</span><br><span class="line">-XX:ParGCCardsPerStrideChunk=4096</span><br><span class="line">-XX:MaxGCPauseMillis=100</span><br><span class="line">-XX:MaxMetaspaceSize=256M</span><br><span class="line">-XX:MetaspaceSize=256M</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-Xloggc:/home/hisen/gc.log</span><br></pre></td></tr></table></figure><h1 id="二、CMS-设置"><a href="#二、CMS-设置" class="headerlink" title="二、CMS 设置"></a>二、CMS 设置</h1><div class="post-button text-center"><a class="btn" href="/20201019-java-hotspot-vm-cms-g1-setting-log/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20201010-how-to-manage-a-redis-database/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20201010-how-to-manage-a-redis-database/" itemprop="url">英语文档：how-to-manage-a-redis-database.pdf</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-10T01:17:00+08:00">2020-10-10 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">database</span> </a></span></span><span id="/20201010-how-to-manage-a-redis-database/" class="leancloud_visitors" data-flag-title="英语文档：how-to-manage-a-redis-database.pdf"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>当初这个文档应该是在『科技爱好者周刊』上还是哪里发现的<br>看这个文档本来的目的是每天坚持阅读英文文档<br>技术文档一般都比较简洁易懂，英语是一个长期的过程，还得继续坚持阅读~</p><p>看的过程中发现，结合一定的场景，和示例<br>和官方文档相比，没有那么枯燥，也更好理解<br>甚至有一些之前未曾关注的用法让我感到惊艳</p><p>所以推荐一下</p><p>下载地址：<a href="https://assets.digitalocean.com/books/how-to-manage-a-redis-database.pdf" target="_blank" rel="noopener">how-to-manage-a-redis-database.pdf</a></p></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20200926-BeanUtils-copyLimitedProperties-for-better-performance-of-response/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20200926-BeanUtils-copyLimitedProperties-for-better-performance-of-response/" itemprop="url">BeanUtils 对象拷贝 - 仅拷贝指定属性 - 接口性能优化</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-26T16:11:00+08:00">2020-09-26 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span> </a></span></span><span id="/20200926-BeanUtils-copyLimitedProperties-for-better-performance-of-response/" class="leancloud_visitors" data-flag-title="BeanUtils 对象拷贝 - 仅拷贝指定属性 - 接口性能优化"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="零、背景"><a href="#零、背景" class="headerlink" title="零、背景"></a>零、背景</h1><p>很多时候我们调用接口并不是需要接口返回的所有信息;<br>就像查询数据库很少使用 select * from table; 一样;</p><p>为了使现有的存储结构以及代码逻辑改动最少<br>想办法在最外层的接口对返回的对象进行精简</p><p>目的使为了提高接口性能：减少 RPC 传输时间、节省网络带宽、节省序列化开销</p><h1 id="一、方案"><a href="#一、方案" class="headerlink" title="一、方案"></a>一、方案</h1><ol><li>直接创建一个对象，根据入参传入的所需字段，写一堆 if else 进行 get set;</li><li>使用序列化工具，转为类似 Map 结构，取值拼装;</li><li>使用 BeanWrapper 操作对象;</li></ol><p>前面两种比较呆板，属于定制化开发;</p><h1 id="二、实践"><a href="#二、实践" class="headerlink" title="二、实践"></a>二、实践</h1><p>Spring BeanWrapper 方案处理非集合对象比较完美，输出对象小不少;<br>基本数据类型有默认值，无法去除，不过这种对大小影响不大;<br>完整代码：<a href="https://github.com/hisenyuan/IDEAPractice/blob/master/src/main/java/com/hisen/copy/smaller/utils/CopyLimitedPropertiesUtil.java" target="_blank" rel="noopener">github.com</a><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Order order = getOrder();</span><br><span class="line">    Order smallerOrder = <span class="keyword">new</span> Order();</span><br><span class="line">    List&lt;String&gt; keepFields = Lists.newArrayList();</span><br><span class="line">    keepFields.add(<span class="string">"orderId"</span>);</span><br><span class="line">    keepFields.add(<span class="string">"address.province"</span>);</span><br><span class="line">    <span class="comment">// i want get all names, not only index 1, how to do ?</span></span><br><span class="line">    keepFields.add(<span class="string">"productInfos[1].name"</span>);</span><br><span class="line">    copyLimitedProperties(order, smallerOrder, keepFields);</span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">    System.out.println(<span class="string">"src:"</span> + gson.toJson(order));</span><br><span class="line">    System.out.println(<span class="string">"des"</span> + gson.toJson(smallerOrder));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><div class="post-button text-center"><a class="btn" href="/20200926-BeanUtils-copyLimitedProperties-for-better-performance-of-response/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20200915-the-puzzle-of-mysql-using-index-which-violation-of-leftmost-matching-principle/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20200915-the-puzzle-of-mysql-using-index-which-violation-of-leftmost-matching-principle/" itemprop="url">MySQL查询违反最左匹配原则，但 explain 显示走索引的疑惑</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-15T21:45:00+08:00">2020-09-15 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span> </a></span></span><span id="/20200915-the-puzzle-of-mysql-using-index-which-violation-of-leftmost-matching-principle/" class="leancloud_visitors" data-flag-title="MySQL查询违反最左匹配原则，但 explain 显示走索引的疑惑"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="零、本文背景"><a href="#零、本文背景" class="headerlink" title="零、本文背景"></a>零、本文背景</h1><p>有个朋友抛出一个问题，<em>明显不符合最左匹配原则的 SQL，居然走索引了</em><br>兜兜转转，嘀咕了好几天，期间也和几个朋友讨论了一下<br>都没有结果，最后还是在 MySQL 的官方文档中找到了原因<br>记录下，也算是一次不错的探索。</p><h1 id="一、问题描述"><a href="#一、问题描述" class="headerlink" title="一、问题描述"></a>一、问题描述</h1><h2 id="1-1-表结构"><a href="#1-1-表结构" class="headerlink" title="1.1 表结构"></a>1.1 表结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`people_new`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`last_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`first_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`bob`</span> <span class="built_in">date</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`index_union`</span> (<span class="string">`last_name`</span>,<span class="string">`first_name`</span>,<span class="string">`bob`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">2</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'人员-新'</span></span><br></pre></td></tr></table></figure><h2 id="1-2-数据"><a href="#1-2-数据" class="headerlink" title="1.2 数据"></a>1.2 数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from people_new;</span><br><span class="line">+----+-----------+------------+------------+</span><br><span class="line">| id | last_name | first_name | bob        |</span><br><span class="line">+----+-----------+------------+------------+</span><br><span class="line">|  1 |  hisen    | yuan       | 2008-08-08 |</span><br><span class="line">+----+-----------+------------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="1-3-SQL-分析"><a href="#1-3-SQL-分析" class="headerlink" title="1.3 SQL 分析"></a>1.3 SQL 分析</h2><p>可以看到 <strong>Using index</strong><br>但是 <strong>possible_keys</strong> null 而 <strong>key</strong> 显示 index_union<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from people_new  where bob = &apos;2008-08-08&apos; and first_name = &apos;yuan&apos;;</span><br><span class="line">+----+-------------+------------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+</span><br><span class="line">| id | select_type | table      | partitions | type  | possible_keys | key         | key_len | ref  | rows | filtered | Extra                    |</span><br><span class="line">+----+-------------+------------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+</span><br><span class="line">|  1 | SIMPLE      | people_new | NULL       | index | NULL          | index_union | 1537    | NULL |    1 |   100.00 | Using where; Using index |</span><br><span class="line">+----+-------------+------------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><p></p><h1 id="二、原因"><a href="#二、原因" class="headerlink" title="二、原因"></a>二、原因</h1><div class="post-button text-center"><a class="btn" href="/20200915-the-puzzle-of-mysql-using-index-which-violation-of-leftmost-matching-principle/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20200805-software-engineer-interview-guide/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20200805-software-engineer-interview-guide/" itemprop="url">软件工程师面试指引</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-05T09:45:00+08:00">2020-08-05 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span> </a></span></span><span id="/20200805-software-engineer-interview-guide/" class="leancloud_visitors" data-flag-title="软件工程师面试指引"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="零、关于面试"><a href="#零、关于面试" class="headerlink" title="零、关于面试"></a>零、关于面试</h1><p>面试决定因子：70% 能力、20% 缘分、10% 行情。<br>软件工程师这条不归路，永远都走不到头，每天进步一点点，早日走上人生巅峰。</p><h1 id="一、面经-知识点"><a href="#一、面经-知识点" class="headerlink" title="一、面经/知识点"></a>一、面经/知识点</h1><p>仓库中的东西更多是抛砖引玉<br>提供业界比较通用/关注的技术<br>还得贴合自身需要深入去学习</p><p>基础指引：<a href="https://github.com/Snailclimb/JavaGuide" target="_blank" rel="noopener">https://github.com/Snailclimb/JavaGuide</a><br>进阶之路：<a href="https://github.com/doocs/advanced-java" target="_blank" rel="noopener">https://github.com/doocs/advanced-java</a><br>简历打磨：<a href="https://github.com/geekcompany/ResumeSample/blob/master/java.md" target="_blank" rel="noopener">https://github.com/geekcompany/ResumeSample/blob/master/java.md</a><br>编程书籍：<a href="https://github.com/jobbole/awesome-programming-books" target="_blank" rel="noopener">https://github.com/jobbole/awesome-programming-books</a><br>大厂试题：<a href="https://github.com/0voice/interview_internal_reference" target="_blank" rel="noopener">https://github.com/0voice/interview_internal_reference</a></p><p>后续持续更新，多交流，共同成长。</p></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20200723-Few-people-know-that-they-are-ignorance/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20200723-Few-people-know-that-they-are-ignorance/" itemprop="url">王慧文(美团)：很少人知道自己在愚昧之巅</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-23T05:45:00+08:00">2020-07-23 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/随说/" itemprop="url" rel="index"><span itemprop="name">随说</span> </a></span></span><span id="/20200723-Few-people-know-that-they-are-ignorance/" class="leancloud_visitors" data-flag-title="王慧文(美团)：很少人知道自己在愚昧之巅"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="零、写在前面"><a href="#零、写在前面" class="headerlink" title="零、写在前面"></a>零、写在前面</h1><p>早几天在领导 JG 的朋友圈看到这篇文章<br>简单几个字的标题，让我产生了兴趣<br>一来这个标题是挺吸引人，典型的自媒体文章<br>二来JG 之前推过一些书很不错<br>三来一般领导朋友圈都不会推垃圾信息</p><p>全文看来其实感觉还是挺切合我的认知：</p><ol><li>人很难认清自己，很难找到方向，成长路上有他人指点会很棒</li><li>除了遇到的人合读过的书，十年之后你还是你</li><li>多与他人交流，多帮助他人，利人利己</li><li>运动、学习、反馈、重塑大脑</li></ol><p>离开学校<br>大部分时间都是围绕着工作<br>有些人可能觉得当前的工作不满意<br>然后想着学点什么高大上的东西为以后的工作做准备<br>极端情况下这种选择是对的，大部分情况会让自己进退两难<br>正确的选择应该是：过好当下，瞭望远方，持续学习，总结反思，慢慢进步<br>架构师同事 SGLS 说过：做好当下的事情才是最重要的，不管现在是做什么项目，设计和实现是我们自己可以控制的。</p><p>以下为原文<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">审视是一个特别好的词。当一个人开始审视世界、审视经历、审视自己的时候，更容易做出有担当的选择。</span><br><span class="line">作为美团“二号首长”，王慧文选择在2020年底正式“退休”，这不可分说地成为了焦点——</span><br><span class="line">王慧文，是怎么成为“王慧文”的？</span><br></pre></td></tr></table></figure><p></p><h1 id="一、“不自我设限”，造就无边界的王慧文"><a href="#一、“不自我设限”，造就无边界的王慧文" class="headerlink" title="一、“不自我设限”，造就无边界的王慧文"></a>一、“不自我设限”，造就无边界的王慧文</h1><p>什么是促使人成长的本质原因？<br>王慧文一直在渴求突破，也一直在探究这个问题。</p><h2 id="1-人要接受变化，有动荡才有进化"><a href="#1-人要接受变化，有动荡才有进化" class="headerlink" title="1. 人要接受变化，有动荡才有进化"></a>1. 人要接受变化，有动荡才有进化</h2><p>王慧文修行的开端，就是校内网。<br>2006年3月，王慧文、王兴和另外四名同伴绞尽脑汁、黑白颠倒，终于让校内网收获了一百多万用户。<br>王兴开始四处找投资，但在多数投资人眼里看来，他们仍是群“生瓜蛋子”、“杂牌军”，校内网不过是几个大学生做的小打小闹的玩意儿。<br>但在这时，千橡集团董事长陈一舟出现了，他愿意拿出一千多万人民币，收购校内网。《九败一胜：美团创始人王兴创业十年》中这样描述<br></p><div class="post-button text-center"><a class="btn" href="/20200723-Few-people-know-that-they-are-ignorance/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20200712-mysql-page-query/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/20200712-mysql-page-query/" itemprop="url">MySQL分页查询</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-12T23:18:00+08:00">2020-07-12 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span> </a></span></span><span id="/20200712-mysql-page-query/" class="leancloud_visitors" data-flag-title="MySQL分页查询"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="零、分页查询"><a href="#零、分页查询" class="headerlink" title="零、分页查询"></a>零、分页查询</h1><p>分页查询一般都会想到 offset limit</p><h2 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h2><p>当不停机需要全量同步数据时<br>有可能会漏掉或者重复处理很多数据<br>因为中途会有数据改动<br>每次分页内的数据与预期的会有出入</p><h2 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h2><p>offset 会进行全表扫描</p><h1 id="一、推荐方案"><a href="#一、推荐方案" class="headerlink" title="一、推荐方案"></a>一、推荐方案</h1><p>通过不变的字段进行排序<br>最好是使用递增的主键索引</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">  from hisen</span><br><span class="line">where id &gt; $&#123;lastId&#125;</span><br><span class="line">  order by id</span><br><span class="line">limit $&#123;pageSize&#125;;</span><br></pre></td></tr></table></figure><h1 id="二、参考"><a href="#二、参考" class="headerlink" title="二、参考"></a>二、参考</h1><div class="post-button text-center"><a class="btn" href="/20200712-mysql-page-query/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></section><nav class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="hisenyuan"><p class="site-author-name" itemprop="name">hisenyuan</p><p class="site-description motion-element" itemprop="description">Java R & D</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">226</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories"><span class="site-state-item-count">25</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">106</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/hisenyuan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="http://weibo.com/hisenyuan" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://www.714.hk" title="梦殇国际" target="_blank">梦殇国际</a></li></ul></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016 - <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">hisenyuan</span></div><div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><span id="busuanzi_container_site_uv">您是第&nbsp;<span id="busuanzi_value_site_uv"></span>&nbsp;个访问者 </span>&nbsp;&nbsp; | &nbsp;&nbsp;<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="theme-info">主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://apps.bdimg.com/libs/fastclick/1.0.0/fastclick.min.js"></script><script type="text/javascript" src="https://apps.bdimg.com/libs/jquery-lazyload/1.9.5/jquery.lazyload.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.js"></script><script type="text/javascript" src="https://apps.bdimg.com/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("xHYsdhTdbcEW58Qv52aYKkQh-gzGzoHsz","L3rafXQHUnwDBfSL0KPuzHlT")</script><script>function showTime(e){var t=new AV.Query(e);$(".leancloud_visitors").each(function(){var e=$(this).attr("id").trim();t.equalTo("url",e),t.find({success:function(t){if(0==t.length){var n=$(document.getElementById(e)).text()+": 0";return void $(document.getElementById(e)).text(n)}var o=t[0],n=$(document.getElementById(e)).text()+": "+o.get("time");$(document.getElementById(e)).text(n)},error:function(e,t){console.log("Error: "+t.code+" "+t.message)}})})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script></body></html><!-- rebuild by neat -->