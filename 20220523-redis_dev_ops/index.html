<!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="redis,redis书籍,redis开发"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="零、背景鉴于目前 Redis 使用广泛虽然数据结构、API 比较简单但是想使用好，还是有一定难度建议了解下《Redis 开发与运维》以达到知其然且知其所以然的境界一、使用场景大规模互联网在线应用流量比较大，响应时间要求高Redis 作为一款流行的高性能数据库对于读多写少的场景，一般作为缓存使用某大型电商订单系统读写比大概在 10:1并且订单读取 90% 的流量都是创建订单当天查询对于可容忍丢数据，"><meta name="keywords" content="redis,redis书籍,redis开发"><meta property="og:type" content="article"><meta property="og:title" content="Redis 开发与运维"><meta property="og:url" content="http://hisen.me/20220523-redis_dev_ops/index.html"><meta property="og:site_name" content="HiSEN"><meta property="og:description" content="零、背景鉴于目前 Redis 使用广泛虽然数据结构、API 比较简单但是想使用好，还是有一定难度建议了解下《Redis 开发与运维》以达到知其然且知其所以然的境界一、使用场景大规模互联网在线应用流量比较大，响应时间要求高Redis 作为一款流行的高性能数据库对于读多写少的场景，一般作为缓存使用某大型电商订单系统读写比大概在 10:1并且订单读取 90% 的流量都是创建订单当天查询对于可容忍丢数据，"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2022-05-23T07:57:04.178Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Redis 开发与运维"><meta name="twitter:description" content="零、背景鉴于目前 Redis 使用广泛虽然数据结构、API 比较简单但是想使用好，还是有一定难度建议了解下《Redis 开发与运维》以达到知其然且知其所以然的境界一、使用场景大规模互联网在线应用流量比较大，响应时间要求高Redis 作为一款流行的高性能数据库对于读多写少的场景，一般作为缓存使用某大型电商订单系统读写比大概在 10:1并且订单读取 90% 的流量都是创建订单当天查询对于可容忍丢数据，"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"undefined",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:"",labels:""}}</script><link rel="canonical" href="http://hisen.me/20220523-redis_dev_ops/"><title>Redis 开发与运维 | HiSEN</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?67bcfe73b301307394c3443503d43472",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">HiSEN</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Personal Technology Blog</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-booklist"><a href="/booklist" rel="section"><i class="menu-item-icon fa fa-fw fa-list-ol"></i><br>书单</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://hisen.me/20220523-redis_dev_ops/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="hisenyuan"><meta itemprop="description" content><meta itemprop="image" content="/images/avatar.gif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HiSEN"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="HiSEN" src></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Redis 开发与运维</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-23T20:29:00+08:00">2022-05-23 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">database</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="零、背景"><a href="#零、背景" class="headerlink" title="零、背景"></a>零、背景</h1><p>鉴于目前 Redis 使用广泛<br>虽然数据结构、API 比较简单<br>但是想使用好，还是有一定难度<br>建议了解下《Redis 开发与运维》<br>以达到知其然且知其所以然的境界</p><h1 id="一、使用场景"><a href="#一、使用场景" class="headerlink" title="一、使用场景"></a>一、使用场景</h1><p>大规模互联网在线应用<br>流量比较大，响应时间要求高<br>Redis 作为一款流行的高性能数据库</p><p>对于读多写少的场景，一般作为缓存使用<br>某大型电商订单系统读写比大概在 10:1<br>并且订单读取 90% 的流量都是创建订单当天查询</p><p>对于可容忍丢数据，但是对性能有极致要求，<br>比如优惠券发放，流量高，这种情况下当做 DB 用也挺好。</p><h1 id="二、问题与建议"><a href="#二、问题与建议" class="headerlink" title="二、问题与建议"></a>二、问题与建议</h1><h2 id="2-1-常见问题"><a href="#2-1-常见问题" class="headerlink" title="2.1 常见问题"></a>2.1 常见问题</h2><ul><li>网络抖动导致 redis 操作失败</li><li>定时任务清理过期 key 导致 IOPS 高<ul><li>redis 做了二次开发，更激进的惰性删除( 针对大面积过期场景 )</li></ul></li><li>热 key 导致流量倾斜<ul><li>考虑 Server 端旁路监听，做统计，然后推送到客户端做内存缓存</li><li>京东有开源热 Key 方案</li></ul></li><li>redis slot 分配不均匀，导致某节点提前内存告警<ul><li>建议分配内存按 slot 分配，而不是节点</li></ul></li></ul><h2 id="2-2-建议"><a href="#2-2-建议" class="headerlink" title="2.2 建议"></a>2.2 建议</h2><ul><li>缓存时间动态可配<a id="more"></a><ul><li>上线后根据业务灵活调整，节约资源</li><li>大促过程中，扩容来不及，可以根据趋势缩短缓存时间，避免淘汰</li></ul></li><li>使用 ProtoStuff 之类的高效序列化工具</li><li>使用 snappy 等高效压缩算法</li></ul><h1 id="三、阅读摘抄"><a href="#三、阅读摘抄" class="headerlink" title="三、阅读摘抄"></a>三、阅读摘抄</h1><p>《Redis开发与运维》20 1121～1122</p><p>dbsize 获取当前数据库中键总数，复杂度 O(1)</p><p>keys * 复杂度 O(n)</p><p>type key 返回 redis 外部数据结构</p><p>object encoding key 返回 redis 内部编码实现</p><p>redis 为单线程模型，所有命令都进队列。</p><p>redis 单线程为何还这么快？</p><ol><li>纯内存访问，内存响应约 100 ns，快的基础</li><li>非阻塞 I/O，事件驱动</li><li>单线程避免了线程切换和竞态产生的消耗</li></ol><p>锁和线程切换通常是性能杀手。</p><p>单线程可以简化数据结构和算法。</p><p>由于是单线程，所以对每个命令执行时间有要求。<br>redis 是面向快速执行场景的数据库。</p><p>mget 结果是按照传入键的顺序返回。</p><p>redis 中每个中文占 3 个字节<br>随说：utf-8 汉字 3 ，ascii unicode 2</p><p>字符串类型的内部编码有 3 种：</p><ol><li>int：8 字节的长整形</li><li>embstr：≤ 39 字节的字符串</li><li>raw：＞ 39 字节的字符串</li></ol><p>list 的 lrange 操作获取指定索引范围的元素。</p><ul><li>索引下标从左到右是 0～N-1</li><li>索引下标从右到左是 -1～-N</li><li>并且 end 包含了自身，很多编程语言不包含</li></ul><p>对于字符串类型的键，再次执行 set 命令会将上次的过期时间去掉。</p><p>纯内存存储、I/O多路复用技术、单线程架构是 redis 高性能的三个因素。</p><p>了解每个命令的时间复杂度在</p><p>redis 命令真正执行的时间通常在微妙级别，所以才会有 redis 性能瓶颈是网络的说法。</p><p>原生批命令与 pipeline 的区别：</p><ol><li>原生批命令是原子的，pipeline 是非原子的</li><li>原生一命令多 key，pipeline 支持多命令</li><li>原生是 redis 服务端实现，pipeline 客户端+服务端 实现</li></ol><p>pipeline 只能操作一个 redis 实例，但即使在分布式 redis 场景中，也可以作为批量操作的重要优化手段。</p><p>redis 3.2 版本提供了 geo 功能，支持 LBS 服务。<br>geo 功能是 redis 借鉴了 ardb 功能实现，ardb 的作者来自中国。</p><p>输出缓冲区由两部分组成：</p><ol><li>固定缓冲区 16KB，返回比较小的执行结果</li><li>动态缓冲区，列表实现，返回较大的结果</li></ol><p>RESP(Redis Serialization Protocol Redis)，协议。<br>保证客户端与服务端的正常通信，是各种编程语言开发客户端的基础。</p><p>jedis 没有内置序列化工具，需要自己选用。<br>page 121 有使用 protostuff (protobuf的Java客户端)进行操作的例子。<br>随说：这块 21 年出实际场景测试过，时间、空间复杂度优化幅度都蛮大</p><p>理解 redis 通信原理和建立完善的监控系统对快速定位客户端常见问题非常有帮助。</p><p>redis 默认采用 LZF 算法对生成的 RDB 文件做压缩处理，压缩后的文件远远小于内存大小。</p><p>正常情况下，fork 操作耗时应该是每 GB 消耗 20 毫秒左右。</p><p>redis 是 CPU 密集型服务，不要做绑定单核 CPU 操作。<br>由于子进程非常消耗 CPU，会和父进程产生单核资源竞争。</p><p>子进程通过 fork 操作产生，理论上需要两倍的内存来完成持久化，<br>但 Linux 有写时复制机制(copy-on-write)，<br>父子进程会共享相同的物理内存页，<br>当父进程处理写请求时会把要修改的页创建副本，<br>而子进程在 fork 操作过程中共享整个父进程内存快照。</p><p>复制功能是高可用 redis 的基础。</p><p>主从复制延迟，redis 提供了 repl-disable-tcp-nodelay 参数控制是否关闭，<br>TCP_NODELAY，默认为 no，即开启 TCP_NODELAY 功能，<br>这时主节点会合并较小的 TCP 数据包节省带宽但是增大了主从之间的延迟，<br>适用于跨机房部署。如果为 yes，那么会立即发送，适合同机房网络。</p><p>对于写并发量较高的场景，<br>多个从节点会导致主节点写命令的多次发送从而过度消耗网络带宽，<br>同时也加重了主节点的负载影响服务稳定性。</p><p>psync 2.8 以上支持，有全量复制，部分复制<br>需要组件支持：</p><ol><li>主从节点各自复制偏移量</li><li>主节点复制积压缓冲区</li><li>主节点运行 id</li></ol><p>redis 支持无盘复制，repl-diskless-sync，试验阶段，<br>rdb 文件不保存到硬盘而直接通过网络发送给从节点。</p><p>为了降低主从延迟，<br>一般把 redis 主从部署在同机房 / 同城机房，<br>避免网络延迟和网络分区造成的心跳中断等情况。</p><p>对于读写分离，会造成从节点数据延迟，<br>可以编写外部监控程序监听主从节点的复制偏移量，<br>当延迟较大时出发报警或者通知客户端避免读取延迟过高的从节点。</p><p>为了保证复制一致性，从节点自身永远不会主动删除超时数据。</p><p>建议做读写分离之前，<br>可以考虑使用 redis cluster 等分布式解决方案，<br>这样不止扩展了读性能还可以扩展写性能和可支撑数据规模，<br>并且一致性和故障转移也可以得到保证，<br>对客户端的维护逻辑也相对容易。读写分离成本太高</p><p>redis-cli –bigkeys<br>把历史扫描过的最大对象统计出来，分析优化</p><p>带宽瓶颈通常出现在以下几个方面：</p><ol><li>机器网卡带宽</li><li>机架交换机带宽</li><li>房之间专线带宽</li></ol><p>网络快慢：同物理机 ＞ 同机架 ＞ 跨机架 ＞ 同机房 ＞ 同城机房 ＞ 异地机房<br>随说：但它们的容灾性正好相反</p><p>redis 进程的内存消耗主要包括：自身内存 + 对象内存 + 缓冲内存 + 内存碎片。</p><p>对象内存是 redis 内存占用最大的一块，存储着用户所有的数据。</p><p>输入输出缓冲区在大流量的场景中容易失控，造成 redis 内存的不稳定，需要重点关注。</p><p>由于进程内保存大量的键，<br>维护每个键精准的过期删除机制会导致消耗大量的 CPU，<br>对于单线程的 redis 来说成本过高，<br>因此 redis 采用惰性删除和定时任务删除机制实现过期键的内存回收。</p><p>在高并发放场景下，建议字符串长度控制在 39 字节以内，<br>以减少 redisObject 内存分配次数，从而提高性能。</p><p>尽量减少字符串频繁修改操作如 append、setrange，<br>改为直接使用 set 修改字符串，降低预分配带来的内存浪费和内存碎片化。</p><p>redis sentinel 有一套合理的监控机来判断节点不可达，有三个定时任务：</p><ol><li>每 10s 向主节点发送 info 信息获取最新拓扑</li><li>每 2s 向 sentinel 频道发送对主节点的判断以及自身的信息</li><li>每 1s sentinel 向主节点、从节点、其余 sentinel 发送 ping 做心跳检测，来确认节点是否可达。</li></ol><p>redis 使用 raft 算法实现领导者的选举。</p><p>redis sentinel 是 redis 的高可用方案实现：故障发现、故障自动转移、配置中心、客户端通知</p><p>redis sentinel 模式下，客户端初始化连接的是 sentinel 节点集合，<br>不再是具体的 redis 节点，但 sentinel 只是配置中心不是代理。</p><p>redis cluster 是 redis 的分布式解决方案。当遇到单机内存、并发、流量等瓶颈时，<br>可以采用 cluster 架构方案达到负载均衡的目的。</p><p>redis cluster 之前的分布式方案：</p><ol><li>客户端分片，客户端比较重，需要处理路由、高可用、故障转移等问题。</li><li>代理方案，部署麻烦，性能损耗。</li></ol><p>数据分区是分布式存储的核心，<br>理解和灵活运用数据分区规则对于掌握 redis cluster 非常有帮助。</p><p>redis cluster 限制：</p><ol><li>批量操作支持有限，目前 mget、mset 只支持具有相同 slot 值的 key 执行批量操作。</li><li>key 事务操作支持有限</li><li>key为数据分区最小力度，hash list 在单机</li><li>不支持多数据库空间</li><li>复制结构只支持一层，不支持嵌套树状</li></ol><p>在分布式存储中需要提供维护节点元数据信息的机制，<br>所谓元数据是指：节点负责哪些数据，是否出现故障等状态信息。</p><p>常见的元数据维护方式分为：集中式、P2P方式</p><p>redis cluster 采用 P2P 的 Gossip(流言) 协议，<br>Gossip 协议工作原理就是节点彼此不断通信交换信息，<br>一段时间之后所有节点都会知道集群完整信息。</p><p>虽然 Gossip 协议的信息交换机制具有天然的分布式特性，但他是有成本的。<br>redis 集群内节点通信频率为每秒 10次。单次通信消息 ＞ 2KB，<br>消息体携带的数据量根集群节点数息息相关，更大的集群代表更大的通信成本。<br>因此对于 redis 集群来说并不是大而全的集群更好，需要对集群的规模做限制。<br>随说：大规模集群可以考虑使用哨兵模式、或者拆分 redis cluster</p><p>集群内 Gossip 消息通信本身会消耗带宽，官方建议集群最大规模在 1000 以内。</p><p>redis cluster 可以实现对节点的灵活上下线控制。<br>其中原理可以抽象为槽和对应数据在不同节点之间的灵活移动。</p><p>集群伸缩＝槽和数据在节点之间移动。</p><p>MOVED 重定向：在集群模式下 redis 接收 key 相关命令先计算对应的槽，再根据槽找到节点，<br>如果节点是自身，则处理命令，否则返回 MOVED 重定向错误，通知客户端请求正确的节点。</p><p>键使用大括号包含的内容又叫做 hash_tag，它提供不同的键可以具备相同的 slot 功能，<br>常用于 redis I/O 优化。在集群模式下实现 mget mset pipeline 等操作。</p><p>smart 客户端通过在内部维护<br>slot → node 的映射关系，本地就可以实现<br>key → node 的查找，从而保证 I/O 效率低最大化，而 MOVED 重定向负责协助 smart 客户端更新 slot → node 映射。</p><p>jediscluster 解析 cluster slots 结果缓存到本地，为每个节点创建唯一的 jedispool 连接池。</p><p>cluster slots 风暴：</p><ol><li>重试机制导致 I/O 通信放大问题</li><li>个别节点异常导致频繁获取 slots 信息</li><li>频繁触发更新本地 slots 缓存操作，内部用了写锁，阻塞对集群所有的命令调用。</li></ol><p>针对以上问题，jedis 2.8.2 版本做了改进：</p><ol><li>当接收到 JedisConnectionException 时不再轻易初始化 slots 缓存，大幅降低内部 I/O 次数。</li><li>当更新 slots 缓存时，不再使用 ping 检测节点活跃度，并且使用 redis covering 变量保证同一时刻只有一个线程更新 slots 缓存，其它线程忽略，优化了写锁阻塞和 cluster slots 调用次数</li></ol><p>jedis cluster 中由于 key 分布在不同的节点上，会造成无法实现 mget、mset 等功能。<br>但是可以利用 CRC16 计算出 key → slot，以及 smart 客户端保存 slot → node 的特性，<br>将属于同一个 redis 节点的 key 进行归类，<br>然后分别对每个节点对应的子 key 列表执行 mget 或者 pipeline 操作。</p><p>ASK 与 MOVED 都是对客户端重定向控制，ASK 表示集群正在进行 slot 迁移，<br>不知道什么时候完成。MOVED 明确表示 slot 对应的节点，因此需要更新 slot 缓存。</p><p>配置纪元的应用场景有：</p><ol><li>新节点加入</li><li>槽节点映射冲突检测</li><li>从节点投票选举冲突检测</li></ol><p>配置纪元的主要作用：</p><ol><li>标示集群内每个主节点的不同版本和当前集群最大版本。</li><li>每次集群发生重要事件，都会递增纪元</li><li>大的纪元表示更新的状态</li></ol><p>唯品会开发的 redis-migrate-tool 支持在线迁移，<br>采用多线程加速，提供数据校验和查看迁移状态等功能。<br>随说：在 github 开源了</p><p>缓存更新策略最佳实践</p><ol><li>低一致性业务建议配置最大内存和淘汰策略</li><li>高一致性业务结合 expire 和主动更新</li></ol><p>缓存粒度问题</p><ol><li>全部字段缓存通用易维护，报文大性能低</li><li>部分字段缓存通用性低，维护复杂，高效<br>随说：考虑使用 hash 全量存，按需取</li></ol><p>使用布隆过滤器减少缓存击穿，page 351<br>随说：订单业务很难做到，特别是订单量大</p><p>无底洞：投入越多不一定产出越多</p><ol><li>客户端一次批量操作会涉及多次网络开销，节点越多越耗时</li><li>网络连接数变多，对性能也会有影响</li></ol><p>无底洞优化</p><ol><li>命令本身的优化，例如优化 SQL 语句</li><li>减少网络通信次数</li><li>降低接入成本，使用连接池 / NIO 等</li><li>客户端 n 次 get，n 次网络 + n 次 get 命令</li><li>客户端 1 次 pipeline get，1 网络 + n get</li><li>客户端 1 次 mget，1 网络 + 1 mget<br>随说：以上针对单个 redis 节点，非 cluster</li></ol><p>NTP 是一种保证不同时钟一致性的服务。</p><p>redis cluster | sentinel 如果多个节点时间不一致，<br>会影响日志排查，但不会影响功能，节点依赖各自的时钟。</p><p>redis 公网无密码情况下，黑客可以写入公钥，通过设置 rdb 文件目录到 /root/.ssh 目录，<br>并且文件名设置为 authorized_keys 即可实现免密登录。爆破主机。</p><p>redis bind 参数指定的是 redis 和哪个网卡绑定(建议绑定内网)，和客户端什么网段没有关系。</p><p>bigkey，一般字符串类型 value 超过 10KB 就是 bigkey 了，但这个值和具体的 OPS 相关。</p><p>redis 查看 key 的大小：debug object key<br>看其中的 serializedlength 即可。</p></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/java/" rel="tag"># java</a> <a href="/tags/redis/" rel="tag"># redis</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/20220326-Get-to-know-spring-AOP-and-BeanPostProcess/" rel="next" title="初识 Spring AOP 与 BeanPostProcess"><i class="fa fa-chevron-left"></i> 初识 Spring AOP 与 BeanPostProcess</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/20220528-baidu-map-api-address-to-longitude-and-latitude/" rel="prev" title="百度地图 API - 地址 转 经纬度">百度地图 API - 地址 转 经纬度 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="hisenyuan"><p class="site-author-name" itemprop="name">hisenyuan</p><p class="site-description motion-element" itemprop="description">Java R & D</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">252</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories"><span class="site-state-item-count">28</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">106</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/hisenyuan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="http://weibo.com/hisenyuan" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://www.yuque.com/ruanyf/weekly" title="科技爱好者周刊" target="_blank">科技爱好者周刊</a></li><li class="links-of-blogroll-item"><a href="https://tech.meituan.com" title="美团技术团队" target="_blank">美团技术团队</a></li><li class="links-of-blogroll-item"><a href="http://duanple.com/?p=170" title="duanple(老师木)" target="_blank">duanple(老师木)</a></li><li class="links-of-blogroll-item"><a href="https://www.yinwang.org" title="当然我在扯淡(王垠)" target="_blank">当然我在扯淡(王垠)</a></li><li class="links-of-blogroll-item"><a href="http://nteswjq.blog.163.com" title="段永平的博客" target="_blank">段永平的博客</a></li><li class="links-of-blogroll-item"><a href="http://www.714.hk" title="梦殇国际" target="_blank">梦殇国际</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#零、背景"><span class="nav-number">1.</span> <span class="nav-text">零、背景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一、使用场景"><span class="nav-number">2.</span> <span class="nav-text">一、使用场景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、问题与建议"><span class="nav-number">3.</span> <span class="nav-text">二、问题与建议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-常见问题"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 常见问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-建议"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 建议</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、阅读摘抄"><span class="nav-number">4.</span> <span class="nav-text">三、阅读摘抄</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016 - <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">hisenyuan</span></div><div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><span id="busuanzi_container_site_uv">您是第&nbsp;<span id="busuanzi_value_site_uv"></span>&nbsp;个访问者 </span>&nbsp;&nbsp; | &nbsp;&nbsp;<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="theme-info">主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://apps.bdimg.com/libs/fastclick/1.0.0/fastclick.min.js"></script><script type="text/javascript" src="https://apps.bdimg.com/libs/jquery-lazyload/1.9.5/jquery.lazyload.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.js"></script><script type="text/javascript" src="https://apps.bdimg.com/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">var isfetched=!1,search_path="search.xml",path="/"+(search_path=0==search_path.length?"search.xml":search_path);function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var searchFunc=function(e,c,r){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),e=document.getElementById(c),a=document.getElementById(r);e.addEventListener("input",function(){var p=0,h='<ul class="search-result-list">',u=this.value.trim().toLowerCase().split(/[\s\-]+/);a.innerHTML="",1<this.value.trim().length&&t.forEach(function(e){var a,c,t,r,n=!1,s=e.title.trim().toLowerCase(),o=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=decodeURIComponent(e.url),l=-1;""!=s&&u.forEach(function(e,t){a=s.indexOf(e),c=o.indexOf(e),(0<=a||0<=c)&&(n=!0,0==t&&(l=c))}),n&&(p+=1,h+="<li><a href='"+i+"' class='search-result-title'>"+s+"</a>",i=e.content.trim().replace(/<[^>]+>/g,""),0<=l&&(e=l+80,(e=0==(t=(t=l-20)<0?0:t)?50:e)>i.length&&(e=i.length),r=i.substring(t,e),u.forEach(function(e){var t=new RegExp(e,"gi");r=r.replace(t,'<b class="search-keyword">'+e+"</b>")}),h+='<p class="search-result">'+r+"...</p>"),h+="</li>")}),h+="</ul>",0==p&&(h='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==u&&(h='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),a.innerHTML=h}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("xHYsdhTdbcEW58Qv52aYKkQh-gzGzoHsz","L3rafXQHUnwDBfSL0KPuzHlT")</script><script>function showTime(e){var t=new AV.Query(e);$(".leancloud_visitors").each(function(){var n=$(this).attr("id").trim();t.equalTo("url",n),t.find({success:function(e){if(0==e.length)return t=$(document.getElementById(n)).text()+": 0",void $(document.getElementById(n)).text(t);var e=e[0],t=$(document.getElementById(n)).text()+": "+e.get("time");$(document.getElementById(n)).text(t)},error:function(e,t){console.log("Error: "+t.code+" "+t.message)}})})}function addCount(n){var e=$(".leancloud_visitors"),o=e.attr("id").trim(),i=e.attr("data-flag-title").trim(),e=new AV.Query(n);e.equalTo("url",o),e.find({success:function(e){var t;0<e.length?((e=e[0]).fetchWhenSave(!0),e.increment("time"),e.save(null,{success:function(e){$(document.getElementById(o)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})):(e=new n,(t=new AV.ACL).setPublicReadAccess(!0),t.setPublicWriteAccess(!0),e.setACL(t),e.set("title",i),e.set("url",o),e.set("time",1),e.save(null,{success:function(e){$(document.getElementById(o)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}}))},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):1<$(".post-title-link").length&&showTime(e)})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0],e=(t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}()</script></body></html>